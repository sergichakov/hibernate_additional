<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">
        <changeSet context="legacy" author="Melchakov Sergej" id="2-domain-some-domain">
           <tagDatabase tag="initialState"/>
      <!--        <rollback>
                       DROP TABLE comments, tags, tags_tasks, tasks, users;
                       DROP TABLE tags;
                       DROP TABLE tags_tasks;
                       DROP TABLE tasks;
                       DROP TABLE users;

                   </rollback>-->
    </changeSet>
    <changeSet context="legacy" author="Melchakov Sergej" id="1-domain-some-domain">

        <sql>
            create table public.tags
            (
                tag_id bigint generated by default as identity
                    primary key,
                str    varchar(100)
            );

            alter table public.tags
                owner to anton;

            create table public.tasks
            (
                task_id      bigint generated by default as identity
                    primary key,
                create_date  timestamp(6),
                end_date     timestamp(6),
                name         varchar(255),
                start_date   timestamp(6),
                status       varchar(255)
                    constraint tasks_status_check
                        check ((status)::text = ANY
                    ((ARRAY ['NOT_STARTED'::character varying, 'IN_PROGRESS'::character varying, 'DONE'::character varying, 'EXPIRED'::character varying])::text[])),
    task_title   varchar(255),
    user_user_id bigint
        constraint ukhprpqsupc4p9qyl6n0u3g1gx1
            unique
);

            alter table public.tasks
                owner to anton;

            create table public.comments
            (
                id              bigint generated by default as identity
                    primary key,
                comment_of_task varchar(512),
                user_type       varchar(32600),
                task_id         bigint
                    constraint fki7pp0331nbiwd2844kg78kfwb
                        references public.tasks
            );

            alter table public.comments
                owner to anton;

            create table public.tags_tasks
            (
                tag_id  bigint not null
                    constraint fklhcgwyvm8pp01yi8srs528mjw
                        references public.tasks,
                task_id bigint not null
                    constraint fkiopgkmxr44dpd52kii4a6kqgv
                        references public.tags,
                primary key (tag_id, task_id)
            );

            alter table public.tags_tasks
                owner to anton;

            create table public.users
            (
                user_id      bigint not null
                    primary key,
                password     varchar(255),
                user_name    varchar(255),
                task_task_id bigint
                    constraint ukieytm90uffo7xmccespxj894h
                        unique
                    constraint fk87kqume4h0d171l3ingil6xxo
                        references public.tasks
            );

            alter table public.users
                owner to anton;

            alter table public.tasks
                add constraint fkpmrsaikug4g2ia9g3ndhnmnf5
                    foreign key (user_user_id) references public.users;


        </sql>
        <rollback>
            DROP TABLE comments, tags, tags_tasks, tasks, users;
            <!--DROP TABLE tags;
            DROP TABLE tags_tasks;
            DROP TABLE tasks;
            DROP TABLE users;   -->
        </rollback>
        <!--<tagDatabase tag="""initialState"/>-->
    </changeSet>

</databaseChangeLog>